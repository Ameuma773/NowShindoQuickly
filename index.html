<!DOCTYPE html>
<html>

<head>
    <title>NowShindoQuickly</title>
</head>

<style>
    #xCanvas {
        width: 1000px;
        height: 300px;
    }
</style>

<body>
    <h1 id="x"></h1>
    <h1 id="y"></h1>
    <h1 id="z"></h1>
    <canvas id="xCanvas"></canvas>
    <button id="Kyoka" onclick="requesPermission()">加速度センサへの許可を求める</button>
    <script>
        var canvas = document.getElementById("xCanvas");
        canvas.width = 1000;
        canvas.height = 600;

        var context = canvas.getContext("2d");
        var a = 0;

        function requesPermission() {
            if (window.DeviceOrientationEvent) {
                if (DeviceOrientationEvent.requestPermission) {
                    DeviceOrientationEvent.requestPermission().then(function (response) {
                        if (response === "granted") {
                            //document.getElementById("Kyoka").style.visibility = hidden;
                        }
                    }).catch(function (e) {
                        alert("エラーが発生しました。" + e);
                    });
                }
            }
        }

        var n = 2;	// 小数点第n位
        var MaeX = 0;

        //加速度
        window.addEventListener("devicemotion", function (e) {
            var acc = e.acceleration;
            var x = Math.floor(Number(acc.x) * 100 * Math.pow(10, n)) / Math.pow(10, n);
            var y = Math.floor(Number(acc.y) * 100 * Math.pow(10, n)) / Math.pow(10, n);
            var z = Math.floor(Number(acc.z) * 100 * Math.pow(10, n)) / Math.pow(10, n);

            document.getElementById("x").innerText = "X : " + x + "gal";
            document.getElementById("y").innerText = "Y : " + y + "gal";
            document.getElementById("z").innerText = "Z : " + z + "gal";

            x = x / 2;

            // パスをリセット
            context.beginPath();

            // 線を引くスタート地点に移動
            context.moveTo(a - 1, 300 - MaeX / 2);

            // スタート地点から(200,200)まで線を引く
            context.lineTo(a, 300 - x / 2)

            // 線の色
            //context.strokeStyle = "red";

            // 線の太さ
            context.lineWidth = 1;

            // 線を描画する
            context.stroke();

            context.fillRect(a, 300 - x / 2, 1, x);

            MaeX = x;
            a++;
            if (a > 1000) {
                ctx.clearRect(0, 0, 1000, 600);
                a = 0;
            }
        })
    </script>
</body>

</html>
