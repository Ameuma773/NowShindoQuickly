<!DOCTYPE html>
<html>

<body>
    <title>NowShindoQuickly</title>
</body>

<style>
    #Kyoka{
        visibility: hidden;
    }
</style>

<body>
    <h1 id="x"></h1>
    <h1 id="y"></h1>
    <h1 id="z"></h1>
    <button id="Kyoka" onclick="requesPermission()">加速度センサへの許可を求める</button>
    <script>
        var intervalId = setInterval(GetData, 100);

        if (getiOSVersion() != false) {
            document.getElementById("Kyoka").style.visibility = visible;
        }

        function requesPermission() {
            if (window.DeviceOrientationEvent) {
                if (DeviceOrientationEvent.requestPermission) {
                    DeviceOrientationEvent.requestPermission().then(function (response) {
                        if (response === "granted") {
                            document.getElementById("Kyoka").style.visibility = hidden;
                        }
                    }).catch(function (e) {
                        alert("エラーが発生しました。" + e);
                    });
                }
            }
        }

        function getiOSVersion() {
            return parseFloat(
                ('' + (/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent) || [0, ''])[1])
                    .replace('undefined', '3_2').replace('_', '.').replace('_', '')
            ) || false;
        }

        function GetData() {
            //加速度
            window.addEventListener("devicemotion", function (e) {
                var acc = e.accelerationIncludingGravity;
                var x = Number(acc.x).toFixed(3);
                var y = Number(acc.y).toFixed(3);
                var z = Number(acc.z).toFixed(3);

                document.getElementById("x").innerHTML = x;
                document.getElementById("y").innerHTML = y;
                document.getElementById("z").innerHTML = z;
            })
        }
    </script>
</body>

</html>
